(()=>{"use strict";const e={headerCityElement:document.getElementById("header-city"),preloader:document.getElementById("preloader"),citiesPopup:document.getElementById("cities-popup"),citiesPopupUL:document.getElementById("cities-popup-list"),citiesPopupInput:document.getElementById("cities-popup-input"),citiesPopupInputLabel:document.getElementById("cities-popup-input-label"),citiesPopupButton:document.getElementById("cities-popup-btn"),citiesBadges:document.getElementById("cities-badges")};class t{}t.isDownload=!1,t.areasData=[],t.getAreasData=e=>{return i=void 0,s=void 0,c=function*(){if(t.isDownload)return t.areasData;const i=yield fetch(e,{method:"POST"});if(i.status){t.isDownload=!0;const e=yield i.json();t.areasData=t.adapter(e)}},new((n=void 0)||(n=Promise))((function(e,t){function a(e){try{o(c.next(e))}catch(e){t(e)}}function d(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,d)}o((c=c.apply(i,s||[])).next())}));var i,s,n,c},t.adapter=e=>e.reduce(((e,t)=>{const i=[];return i.push({name:t.name,id:String(t.id)}),t.cities&&0!==t.cities.length&&t.cities.forEach((e=>{i.push({name:e.name,id:String(e.id),area:t.name})})),e.push(...i),e}),[]);class i{static toggleSelected(e){i.selected.includes(e)?i.selected=i.selected.filter((t=>t!=e)):i.selected.push(e)}static hide(t){t.stopPropagation(),"BODY"===t.target.tagName&&(e.citiesPopup.classList.add("hidden"),document.body.removeEventListener("click",i.hide))}static getCitiesListHTML(){return t.areasData.map((e=>`<li\n          class="cities-popup__elem ${i.selected.includes(e.id)?"selected":""}"\n          id="${e.id}">\n            <p>${e.name}</p>\n            ${e.area?`<p class="cities-popup__elem-subtext">${e.area}</p>`:""}\n         </li>`)).join(" ")}static getSortedCitiesListHTML(){const s=e.citiesPopupInput.value.trim();if(0===s.length)return i.getCitiesListHTML();const n=new RegExp(`${s}`,"gi"),c=[];return t.areasData.forEach((e=>{e.name.match(n)&&c.push(`<li\n             class="cities-popup__elem ${i.selected.includes(e.id)?"selected":""}"\n             id="${e.id}">\n              ${i.modifyName(e.name,n)}\n              ${e.area?`<p class="cities-popup__elem-subtext">${e.area}</p>`:""}\n            </li>`)})),0===c.length?'<li class="cities-popup__elem_dummy">Ничего не найдено</li>':c.join(" ")}static modifyName(e,t){return e.replace(t,((e,t)=>0===t?`<span class="text-colored">${e[0].toUpperCase()+e.slice(1)}</span>`:`<span class="text-colored">${e}</span>`))}}i.selected=[],i.prevSelected=[];class s{static getBadgesHTML(){return 0===i.selected.length?"":`<ul class="cities-badges__list">\n      ${i.selected.map((e=>{var i;return`\n        <li class="cities-badges__elem" id="${e}">\n            <span class="cities-badges__elem-text">\n            ${null===(i=t.areasData.find((t=>t.id==e)))||void 0===i?void 0:i.name}\n            </span>\n            <button class="cities-badges__elem-btn"></button>\n        </li>`})).join("")}\n      </ul>`}}function n(t){i.toggleSelected(t),e.citiesBadges.innerHTML=s.getBadgesHTML(),e.citiesPopupUL.innerHTML=i.getSortedCitiesListHTML(),i.selected.sort().join(" ")===i.prevSelected.sort().join(" ")?e.citiesPopupButton.classList.remove("cities-popup__btn_colored"):e.citiesPopupButton.classList.add("cities-popup__btn_colored")}class c{static citiesPopupInputLabelHandler(){e.citiesPopupInput.value="",e.citiesPopupUL.innerHTML=i.getSortedCitiesListHTML(),e.citiesPopupInputLabel.classList.add("hidden")}static citiesPopupULHandler(e){const t=e.target.closest(".cities-popup__elem");t&&n(t.id)}static citiesPopupButtonHandler(){i.prevSelected=[...i.selected],e.citiesPopupButton.classList.remove("cities-popup__btn_colored"),document.cookie=`selectedAreasIDList=${JSON.stringify(i.selected)}`,fetch("./",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(i.prevSelected)})}static citiesBadgesClickHandler(e){const t=e.target;t.closest(".cities-badges__elem-btn")&&n(t.closest(".cities-badges__elem").id)}}c.cityElementClickHandler=function(n){return c=this,a=void 0,o=function*(){n.stopPropagation();const c=document.cookie.split(";").find((e=>e.match(/^selectedAreasIDList/)));c&&(i.selected=JSON.parse(c.split("=")[1]),i.prevSelected=[...i.selected]),e.citiesPopup.classList.remove("hidden"),document.body.addEventListener("click",i.hide),t.isDownload||(e.preloader.classList.remove("hidden"),yield t.getAreasData("https://studika.ru/api/areas"),e.preloader.classList.add("hidden"),e.citiesPopupUL.innerHTML=i.getSortedCitiesListHTML(),e.citiesBadges.innerHTML=s.getBadgesHTML(),e.citiesPopupInput.focus())},new((d=void 0)||(d=Promise))((function(e,t){function i(e){try{n(o.next(e))}catch(e){t(e)}}function s(e){try{n(o.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof d?n:new d((function(e){e(n)}))).then(i,s)}n((o=o.apply(c,a||[])).next())}));var c,a,d,o},c.citiesPopupInputHandler=function(t){0===t.target.value.length?e.citiesPopupInputLabel.classList.add("hidden"):e.citiesPopupInputLabel.classList.remove("hidden"),e.citiesPopupUL.innerHTML=i.getSortedCitiesListHTML()},e.headerCityElement.addEventListener("click",c.cityElementClickHandler),e.citiesPopupInput.addEventListener("input",c.citiesPopupInputHandler),e.citiesPopupInputLabel.addEventListener("click",c.citiesPopupInputLabelHandler),e.citiesPopupUL.addEventListener("click",c.citiesPopupULHandler),e.citiesBadges.addEventListener("click",c.citiesBadgesClickHandler),e.citiesPopupButton.addEventListener("click",c.citiesPopupButtonHandler)})();